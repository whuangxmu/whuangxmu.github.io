# 实验目的
通过完成实验，理解物理层传输的基本原理。掌握传输过程中的编解码过程，熟悉传输中的噪声、分辨率、波特率、调制和误码等通信概念；了解奈氏定理和香农定理的含义。

# 用户需求
该实验分为发送方和接收方2个部分。

发送方将信息编码为一组信号，并通过可见光发送。接收方通过手机录制视频的形式接收，并解码得到原始消息。

由于大多数同学普遍尚无法完成手机编程，编码部分可简化为：

1. 接受用户输入消息。
2. 利用 FFmpeg 或 OpenCV 编码生成一系列图像。
3. 利用 FFmpeg 命令行将图像编码为视频。
4. 利用系统播放器播放在普通计算机液晶显示器上。

解码部分可简化为：

1. 手机录制显示器播放的视频，通过 QQ 或 USB 线复制到计算机上。
2. 利用 FFmpeg 命令行将视频解码为图像。
3. 利用 FFmpeg 或 OpenCV 接受上述输入的一组图像。
4. 解码得到消息，输出在界面上。

# 输入输出接口
学生应导出一套用于测评的程序，这里说明其输入输出接口。

## 编码器命令行接口

1. 用户提供一个文件名（`argv[1]`），内容为用户随机生成的一个二进制文件。
2. 用户提供一个文件名（`argv[2]`），用于将编码后的视频输出到该文件。
3. 用户提供一个整数（`argv[3]`），用于约束编码后的视频长度，单位：毫秒。

编码器命令行接口样例：

```
encode in.bin in.mp4 1000
```

## 解码器命令行接口

1. 用户提供一个文件名（`argv[1]`），内容为用户手机拍摄的视频；
2. 用户提供一个文件名（`argv[2]`），用于将解码后的二进制数组输出到该文件；
3. 用户提供一个文件名（`argv[3]`），用于将解码信息是否有效的二进制数组输出到该文件。

解码器命令行接口样例：

```
decode out.mp4 out.bin vout.bin
```

### 解码器输入接口

1. 用户复制到计算机的视频。

（输入示例：手机拍摄的视频文件，本处不再赘述。）

### 解码器输出接口

1. 解码生成的一个二进制信息文件（`out.bin`）；
2. 解码生成的一个二进制文件（`vout.bin`），指示信息文件的每一位是否有效。

解码器输出接口样例（说明格式）：

- 假设 `out.bin`（二进制文件）内容（按字节显示的十六进制）： `13 2F 9B C7`
- 对应的 `vout.bin`（二进制文件，按字节位掩码表示有效性）：`FF FC FF F0`

> 说明：`vout.bin` 中每个位的掩码位表示该位是否正确（1 表示正确，0 表示错误）。评测时请约定具体格式（按字节掩码或按位单字节标记）。程序应在运行结束时，尽可能完整地将原始输入文件恢复出来。

# 技术建议

1. 本项目自选开发语言，但推荐使用 C 或 C++；Python 也可用于快速原型。
2. 熟悉 FFmpeg 命令行使用，调整帧率（fps）、像素格式和编码参数对实验结果有重要影响。
3. 了解如何在程序中调用外部命令（或直接使用 libav/FFmpeg API）以获得更精确控制。
4. 熟悉 OpenCV 用于帧处理、图像采样与颜色空间转换等。

# 提交材料

学生在实现软件以后，在报告中除了给出核心代码截图与运行界面截图外，还需说明并测算以下指标：

1. 在实验中的编解码算法是什么？
2. 在实验中的调制与解调算法是什么？载体信号与调制信号分别是什么？使用的算法属于调频、调幅还是调相？
3. 实验中的主要噪声强度有多大？噪声来自哪些因素？
4. 编码算法的分辨率是多少？（实验不要求分辨率过高）
5. 编码的波特率与实际传输率是多少？
6. 根据奈奎斯特定理和香农定理，通信速率上限是多少？

此外，鼓励学生通过编程调用相关库（而不是仅通过调用 FFmpeg 可执行文件）来操作视频，鼓励实现图形用户界面并使操作流程尽量流畅。

提交时需附加的文件：

1. 生成的模拟随机消息文件：`in.bin`；解码器生成的 `out.bin`、`vout.bin`，总长度不超过 1MB（能支撑拍照时长约 3 秒的信息量即可）；
2. 生成的视频文件 `in.mp4`，以及翻拍后拷回的 `out.mp4`（建议控制在 5 秒以内）。

# 附录一：学生作品

以下代码来自厦门大学信息学院软件工程系 2018 级本科生 李泽政：

- https://github.com/poor-circle/Visual-Net
- https://gitee.com/whuangxm/project-1-eg-lzz

以下代码来自厦门大学信息学院软件工程系 2018 级本科生 宋润涵、张如桢、王奕飞、沈黄隽团队：

- https://github.com/sh963852741/GroupTest
- https://gitee.com/whuangxm/project-1-eg-srh

# 附录二：OpenCV 的使用

访问：<https://github.com/opencv/opencv/releases>，下载最新版本（例如 `opencv-4.5.5-vc14_vc15.exe` 或类似文件），解压到目标位置（例如 `C:\`）。

在 Visual C++ 控制台程序中配置如下（示例）：

- 头文件目录： `C:\opencv\build\include`
- 库文件目录： `C:\opencv\build\x64\vc15\lib`
- 链接库示例： `opencv_world455d.lib`（根据版本调整）

可选：导入 `project-1-eg-lzz` 的头文件与源文件进行编译测试。
