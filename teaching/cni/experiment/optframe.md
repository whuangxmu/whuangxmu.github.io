# 实验目的
通过完成实验，理解数据链路层传输的基本原理。掌握传输过程中的帧格式设计理念；熟悉传输中的帧与成帧、帧定界符等通信概念，熟悉多方通信中的时分、频分、波分或码分多路复用与解复用等概念，熟悉多方通信中的编址的概念。

# 用户需求
在前项实验（第3章）的基础上，设计一个支持多方通信的程序，参照以太网机制，设计良好的帧格式、帧首尾定界符，在帧格式中体现编址概念。

# 输入输出接口
学生应导出一套用于测评的程序，这里说明其输入输出接口。

## 编码器命令行接口

1. 用户提供一个文件目录（`argv[1]`），其下有多个扩展名为“*.bin”的文件，文件名形如“12.bin”，内容为用户随机生成的二进制文件。
2. 用户提供一个整数（`argv[3]`），用于指示最大传输单元，单位：字节；例如 `1500` 表示参与通信的帧总长度最大为 1500 字节。
3. 用户提供一个文件名（`argv[4]`），用于将编码后的视频输出到该文件。
4. 用户提供一个整数（`argv[5]`），用于约束编码后的视频长度，单位：毫秒。

编码器命令行接口样例：

```
encode ./ 150 in.mp4 1000
```

## 解码器命令行接口

1. 用户提供一个文件名（`argv[1]`），内容为用户手机拍摄的视频；
2. 用户提供一个文件目录（`argv[2]`），用于将解码后的二进制数组输出到该目录下，文件名保留参加复用多方的编址部分，扩展名为“*.bin”；
3. 解码器同时应输出与每个 `.bin` 文件对应的 `.val` 文件，表示每个位的有效性（1 表示正确，0 表示错误）。

解码器命令行接口样例：

```
decode out.mp4 ./
```

解码器在指定文件目录下输出：

- 解码生成的多个二进制信息文件（例如 `12.bin`）；
- 解码生成的对应的多个二进制有效性文件（例如 `12.val`），用于标记 `12.bin` 中每个位是否正确。

示例（说明格式）：

- 假设 `12.bin` 的十六进制字节显示为：`13 2F 9B C7`；
- 对应的 `12.val`（按字节位掩码表示有效性）可以是：`FF FC FF F0`（1 表示正确，0 表示错误）。

> 说明：`val` 文件的具体格式评测时需与实现方约定，可采用按字节位掩码或按位单字节标记两种形式。

# 技术建议

1. 帧格式设计可参考以太网，适当调节各字段的位数；编址长度应合理控制，不宜过大；应加入 CRC 校验。

| 帧首定界符 | 目的地址 | 源地址 | 长度 | 载荷 | CRC |
| --- | --- | --- | --- | --- | --- |
| 1 字节 | 1 字节 | 1 字节 | 2 字节 | 0 ~ 65535 字节 | 4 字节 |

2. 帧首尾定界符与转义规则示例：

- 设帧首定界符为 `0xCA`；若帧内出现 `0xCA` 的字节，则用 `0xCC 0xCA` 表示；若帧内出现 `0xCC`，则用 `0xCC 0xCC` 表示（类似字节填充/转义机制）。

3. 建议采用统计时分多路复用（统计 TDM）以提高信道利用率，或在需要低延迟场景下考虑同步 TDM / 时分片方案。

# 提交材料

学生在实现软件以后，在报告中除了给出核心代码截图与运行界面截图外，需说明并测算以下指标：

1. 实验中采用的帧格式是什么？各字段作用与长度范围说明；
2. 如何进行成帧（帧首定界符是什么，如何转义帧内定界符等）；
3. 采用的多路复用算法类型及其基本原理说明；
4. 编址方案与设计理由；
5. 数据载荷的大小范围及设定依据。

# 附注与示例

- 建议在帧设计中对最大传输单元（MTU）进行校验并对超长负载分片处理；
- 建议为每个帧或分片计算并附加 CRC（示例使用 32-bit CRC），以便接收端检测并触发重传；
- 推荐在实现中提供日志与错误统计以便评测；
- 可参考[此前学生作品](./experiment_view.html?id=opttrans#id06)，并在实现中注明借鉴处。
