<!-- Wei HUANG's Gitee Page -->
<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Wei HUANG's Gitee Page">
    <meta name="keywords" content="Wei HUANG">
    <meta name="author" content="Wei HUANG, whuang@xmu.edu.cn">
    <meta name="theme-color" content="#1359a6">

    <script type="text/javascript" src="/static/jquery/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="/static/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/marked/marked.min.js"></script>
    <script type="text/javascript">
        var mode_async_json = true;
        var myoj2_app_name = "黄老师";
        var page_style = "doc-menu";
        var page_docs_header_title = "实验";
        var page_docs_header_desc = "实验详情页面。";
    </script>
</head>
<body>
<noscript>
    <h1 class="text-danger">Error: Your browser does not support
        JavaScript, or you have not enabled it in your browser settings.</h1>
</noscript>
</body>
</html>

<script type="text/html" id="main">
    <div id="experiment-content"></div>
    <div class="modal fade" id="not-found-modal" tabindex="-1" role="dialog" aria-labelledby="not-found-title">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="not-found-title">资源不存在</h4>
                </div>
                <div class="modal-body" id="not-found-message"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">知道了</button>
                </div>
            </div>
        </div>
    </div>
</script>
<style>
    #experiment-content {
        padding: 20px;
        line-height: 1.5;
    }

    #experiment-content p, #experiment-content div, #experiment-content li {
        margin: 1em 0;
    }

    #experiment-content p {
        text-indent: 2em;
    }

    #experiment-content li p {
        text-indent: 0;
    }
</style>

<script type="text/javascript">
    // 菜单配置数据
    var menuConfig = [
        {
            id: 'nav-teaching',
            text: '教学',
            link: '/teaching/',
            icon: 'fa fa-chalkboard-teacher',
            dropdown: [
                {link: '/teaching/cni/', text: '计算机网络'},
                {link: '/teaching/cpd/', text: 'C语言程序设计'},
                {link: '/teaching/aem/', text: '工程数学'}
            ]
        },
        {
            id: 'nav-status-research',
            link: '/research/',
            text: '研究',
            icon: 'fa fa-tasks'
        },
        {
            id: 'nav-release',
            link: '/release/',
            text: '公告',
            icon: 'fa fa-bullhorn'
        },
        {
            id: 'nav-about',
            link: '/about.html',
            text: '简介',
            icon: 'fa fa-trophy'
        }
    ];
</script>
<script type="text/javascript" src="/assets/js/ui.js"></script>

<script type="text/javascript">
    function getQueryParam(name) {
        var match = new RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
        return match ? decodeURIComponent(match[1].replace(/\+/g, ' ')) : '';
    }

    function showNotFound(message) {
        $('#not-found-message').text(message);
        if ($.fn.modal) {
            $('#not-found-modal').modal('show');
        } else {
            alert(message);
        }
    }

    function renderExperiment() {
        var id = getQueryParam('id');
        var container = $('#experiment-content');
        // id supports letters and digits (alphanumeric), at least one character
        if (!id || !/^[0-9A-Za-z]+$/.test(id)) {
            showNotFound('未提供有效的实验 ID（仅支持字母和数字）。');
            mode_async_json = false;
            return;
        }
        var path = './experiment/' + id + '.md';
        $.get(path, function (content) {
            if (window.marked) {
                // use marked to parse markdown
                container.html(window.marked.parse(content));
                $(container).find('table').addClass('table table-striped table-bordered table-hover');
                // add class and ids to h1 headers
                var $headings = container.find('h1').addClass('page-header');
                $headings.each(function (index) {
                    var num = String(index + 1).padStart(2, '0');
                    $(this).attr('id', 'id' + num);
                });

                // unwrap any pre-existing .bs-docs-section to avoid double-wrapping
                container.find('.bs-docs-section').each(function () {
                    $(this).replaceWith($(this).contents());
                });
                var $children = container.children();
                for (var ci = 0; ci < $children.length; ci++) {
                    var $child = $($children[ci]);
                    if (!$child.is('h1')) continue;

                    // collect this h1 and following siblings until next h1 (at the same level)
                    var $group = $child;
                    var cj = ci + 1;
                    while (cj < $children.length && !$($children[cj]).is('h1')) {
                        $group = $group.add($children[cj]);
                        cj++;
                    }

                    // wrap the collected nodes in one section
                    $group.wrapAll('<div class="bs-docs-section"></div>');

                    // skip to the last wrapped child index
                    ci = cj - 1;
                }

                // after rendering, add page-specific link to sidebar (only on this page)
                // ensure sidebar exists then append
                waitUntil(function () {
                    var $sb = $('.bs-docs-sidebar');
                    return $sb.length > 0 && $sb.children().length === 3;
                }, function () {
                    var $sidebar = $('.bs-docs-sidebar');
                    if ($sidebar.length) {
                        // only append if not already present
                        if ($sidebar.find('a.back-to-top[href="./experiment.html"]').length === 0) {
                            var $link = $('<a class="back-to-top" href="./experiment.html"> 返回实验列表 </a>');
                            $sidebar.append($link);
                        }
                    }
                });
            } else {
                container.text(content);
            }
            mode_async_json = false;
        }).fail(function () {
            var message = '未找到对应实验文件：' + path + "。请联系教师核实实验号是否正确，或是否已上传实验文件。";
            container.text(message);
            mode_async_json = false;
            showNotFound(message);
        });
    }

    $(function () {
        renderExperiment();
    });

    load_mathjax();
</script>

